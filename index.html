<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Zeitreise: Interview mit Essam, einem Vorarbeiter im alten Ägypten</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Inter:wght@300;400;500;600&display=swap');
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      min-height: 100vh;
      color: #333;
      overflow-x: hidden;
      position: relative;
    }
    
    /* Animated background elements */
    .bg-decoration {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      overflow: hidden;
    }
    
    .hieroglyph {
      position: absolute;
      color: rgba(218, 165, 32, 0.1);
      font-size: 2rem;
      animation: float 20s infinite linear;
    }
    
    .hieroglyph:nth-child(1) { top: 10%; left: 10%; animation-delay: 0s; }
    .hieroglyph:nth-child(2) { top: 20%; right: 15%; animation-delay: -5s; }
    .hieroglyph:nth-child(3) { top: 60%; left: 5%; animation-delay: -10s; }
    .hieroglyph:nth-child(4) { top: 80%; right: 10%; animation-delay: -15s; }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.1; }
      50% { transform: translateY(-20px) rotate(180deg); opacity: 0.2; }
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .hero {
      text-align: center;
      padding: 60px 20px;
      background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.7)), 
                  url('Baustelle.png');
      background-size: cover;
      background-position: center;
      border-radius: 20px;
      margin-bottom: 40px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.3);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.1);
    }
    
    .hero h1 {
      font-family: 'Cinzel', serif;
      font-size: 3rem;
      color: #DAA520;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
      margin-bottom: 20px;
      background: linear-gradient(45deg, #DAA520, #FFD700, #FFA500);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .hero p {
      font-size: 1.2rem;
      color: #e0e0e0;
      max-width: 800px;
      margin: 0 auto;
      line-height: 1.6;
    }
    
    .section {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 40px;
      margin: 30px 0;
      box-shadow: 0 15px 35px rgba(0,0,0,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #DAA520, #CD853F, #8B4513);
    }
    
    .section:hover {
      transform: translateY(-5px);
      box-shadow: 0 25px 50px rgba(0,0,0,0.15);
    }
    
    .section h2 {
      font-family: 'Cinzel', serif;
      color: #8B4513;
      font-size: 1.8rem;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .section h2 i {
      color: #DAA520;
      font-size: 1.5rem;
    }
    
    .chat-btn {
      display: inline-flex;
      align-items: center;
      gap: 12px;
      background: linear-gradient(135deg, #DAA520 0%, #CD853F 100%);
      color: white;
      padding: 18px 35px;
      border: none;
      border-radius: 50px;
      font-size: 1.1rem;
      font-weight: 600;
      text-decoration: none;
      transition: all 0.3s ease;
      box-shadow: 0 8px 25px rgba(218, 165, 32, 0.3);
      position: relative;
      overflow: hidden;
      cursor: pointer;
    }
    
    .chat-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }
    
    .chat-btn:hover::before {
      left: 100%;
    }
    
    .chat-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 35px rgba(218, 165, 32, 0.4);
      background: linear-gradient(135deg, #FFD700 0%, #DAA520 100%);
    }
    
    .form-group {
      margin-bottom: 25px;
    }
    
    .form-group label {
      display: block;
      font-weight: 600;
      color: #8B4513;
      margin-bottom: 8px;
      font-size: 1rem;
    }
    
    .form-control {
      width: 100%;
      padding: 15px 20px;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      font-size: 1rem;
      transition: all 0.3s ease;
      background: rgba(255,255,255,0.8);
      backdrop-filter: blur(5px);
    }
    
    .form-control:focus {
      outline: none;
      border-color: #DAA520;
      box-shadow: 0 0 0 3px rgba(218, 165, 32, 0.1);
      background: white;
    }
    
    textarea.form-control {
      resize: vertical;
      min-height: 120px;
      font-family: inherit;
    }
    
    .hint {
      background: linear-gradient(135deg, #fff3cd, #fef7e0);
      border: 1px solid #DAA520;
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
    }
    
    .hint strong {
      color: #8B4513;
    }
    
    .question-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .question-card {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border-radius: 15px;
      padding: 20px;
      border-left: 4px solid #DAA520;
      transition: transform 0.3s ease;
    }
    
    .question-card:hover {
      transform: translateX(5px);
    }
    
    .character-profile {
      display: flex;
      align-items: center;
      gap: 20px;
      background: linear-gradient(135deg, #8B4513, #A0522D);
      color: white;
      padding: 30px;
      border-radius: 20px;
      margin: 20px 0;
    }
    
    .character-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: linear-gradient(135deg, #DAA520, #CD853F);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    }
    
    .character-info h3 {
      font-family: 'Cinzel', serif;
      font-size: 1.5rem;
      margin-bottom: 10px;
    }
    
    .character-info p {
      opacity: 0.9;
      line-height: 1.6;
    }
    
    /* iOS-specific modal for save */
    .save-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 10000;
      align-items: center;
      justify-content: center;
    }
    
    .save-modal-content {
      background: white;
      border-radius: 20px;
      padding: 30px;
      max-width: 90%;
      width: 500px;
      text-align: center;
    }
    
    .save-modal h3 {
      color: #8B4513;
      margin-bottom: 20px;
      font-family: 'Cinzel', serif;
    }
    
    .save-modal-text {
      background: #f8f9fa;
      border: 2px solid #DAA520;
      border-radius: 10px;
      padding: 15px;
      margin: 20px 0;
      font-family: monospace;
      font-size: 0.9rem;
      word-break: break-all;
      max-height: 300px;
      overflow-y: auto;
    }
    
    .save-modal-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 20px;
    }
    
    .save-modal-btn {
      padding: 12px 25px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .save-modal-btn.copy {
      background: #DAA520;
      color: white;
    }
    
    .save-modal-btn.close {
      background: #6c757d;
      color: white;
    }
    
    @media (max-width: 768px) {
      .hero h1 {
        font-size: 2rem;
      }
      
      .section {
        padding: 25px;
        margin: 20px 0;
      }
      
      .question-grid {
        grid-template-columns: 1fr;
      }
      
      .character-profile {
        flex-direction: column;
        text-align: center;
      }
    }
    
    .scroll-indicator {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: rgba(218, 165, 32, 0.3);
      z-index: 1000;
    }
    
    .scroll-progress {
      height: 100%;
      background: linear-gradient(90deg, #DAA520, #FFD700);
      width: 0%;
      transition: width 0.1s ease;
    }
  </style>
</head>
<body>
  <div class="scroll-indicator">
    <div class="scroll-progress" id="scrollProgress"></div>
  </div>
  
  <div class="bg-decoration">
    <div class="hieroglyph">𓀀</div>
    <div class="hieroglyph">𓃹</div>
    <div class="hieroglyph">𓂀</div>
    <div class="hieroglyph">𓊪</div>
  </div>

  <div class="container">
    <div class="hero">
      <h1>Zeitreise ins alte Ägypten</h1>
      <p>
        Reise über 4.500 Jahre zurück und führe ein faszinierendes Interview mit Essam, 
        einem erfahrenen Vorarbeiter beim Bau der großen Pyramide von Gizeh zur Zeit des Pharaos Cheops. 
        Entdecke, wie das Leben und Arbeiten in einer der bedeutendsten Epochen der Menschheitsgeschichte wirklich war!
      </p>
    </div>

    <div class="section">
      <h2><i class="fas fa-rocket"></i> Starte deine Zeitreise</h2>
      
      <div class="character-profile">
        <div class="character-avatar">
          <img src="Vorarbeiter.png" alt="Essam ibn Kheti" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
        </div>
        <div class="character-info">
          <h3>Essam ibn Kheti</h3>
          <p>Erfahrener Vorarbeiter bei der Pyramide von Gizeh. Verantwortlich für das Koordinieren der Steinmetze und Arbeiter. Lebt mit seiner Familie in einem Arbeiterdorf nahe der Baustelle.</p>
        </div>
      </div>
      
      <p style="margin-bottom: 30px;">Klicke auf den Button unten, um dein persönliches Interview mit Essam zu beginnen. Bereite dich darauf vor, in eine völlig andere Welt einzutauchen!</p>
      
      <a href="https://wk1973.pythonanywhere.com/static/interview.html" class="chat-btn">
        <i class="fas fa-comments"></i>
        Interview mit Essam starten
      </a>
      
      <div class="hint">
        <strong>Hinweis:</strong> Du kannst deine Fragen im Arbeitsblatt unten vorformulieren und später direkt im Chat stellen. Sprich mit Essam so, als wärst du ein Zeitgenosse – vermeide moderne Begriffe wie "Technologie" oder "Computer"!
      </div>
    </div>

    <div class="section">
      <h2><i class="fas fa-question-circle"></i> Bereite deine Fragen vor</h2>
      <p>Formuliere 4-5 durchdachte Fragen, die dir helfen, Essams Welt zu verstehen:</p>
      
      <div class="question-grid">
        <div class="question-card">
          <div class="form-group">
            <label>🌅 Frage zum Tagesablauf:</label>
            <input type="text" class="form-control" placeholder="Deine Frage hier eingeben...">
          </div>
        </div>
        
        <div class="question-card">
          <div class="form-group">
            <label>🏠 Frage zum Familienleben:</label>
            <input type="text" class="form-control" placeholder="Deine Frage hier eingeben...">
          </div>
        </div>
        
        <div class="question-card">
          <div class="form-group">
            <label>🔨 Frage zu Werkzeugen:</label>
            <input type="text" class="form-control" placeholder="Deine Frage hier eingeben...">
          </div>
        </div>
        
        <div class="question-card">
          <div class="form-group">
            <label>🥘 Frage zum Essen:</label>
            <input type="text" class="form-control" placeholder="Deine Frage hier eingeben...">
          </div>
        </div>
      </div>
      
      <div class="form-group" style="margin-top: 30px;">
        <label>💭 Deine eigene Frage:</label>
        <input type="text" class="form-control" placeholder="Deine Frage hier eingeben...">
      </div>
    </div>

    <div class="section">
      <h2><i class="fas fa-scroll"></i> Dokumentiere Essams Antworten</h2>
      <div class="form-group">
        <label>Wichtige Erkenntnisse aus dem Interview:</label>
        <textarea class="form-control" placeholder="Notiere hier die faszinierendsten Antworten von Essam. Was hat dich überrascht? Welche Details über das Leben im alten Ägypten waren besonders interessant?"></textarea>
      </div>
      
      <div class="hint">
        <strong>Tipp:</strong> Mache Screenshots der interessantesten Antworten und achte darauf, wie authentisch und lebendig Essam seine Welt beschreibt!
      </div>
    </div>

    <div class="section">
      <h2><i class="fas fa-lightbulb"></i> Reflexion & Analyse</h2>
      
      <div style="display: flex; align-items: center; gap: 30px; margin-bottom: 30px; flex-wrap: wrap;">
        <div style="flex: 1; min-width: 300px;">
          <div class="form-group">
            <label>Was hat dich am meisten überrascht?</label>
            <textarea class="form-control" placeholder="Welche Aspekte des Lebens im alten Ägypten waren anders als erwartet? Was möchtest du noch vertiefen?"></textarea>
          </div>
          
          <div class="form-group">
            <label>Kritische Betrachtung:</label>
            <textarea class="form-control" placeholder="Wie glaubwürdig wirkten Essams Antworten? Gibt es Themen, die du gerne noch weiter erforschen möchtest?"></textarea>
          </div>
        </div>
        
        <div style="flex: 0 0 200px;">
          <img src="Cheops.png" alt="Pharao Cheops" style="width: 100%; height: auto; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.3); border: 3px solid #DAA520;">
          <p style="text-align: center; margin-top: 15px; font-size: 0.9rem; color: #8B4513; font-weight: 600;">Pharao Cheops<br><span style="font-size: 0.8rem; opacity: 0.8;">Auftraggeber der großen Pyramide</span></p>
        </div>
      </div>
    </div>

    <div class="section">
      <h2><i class="fas fa-magic"></i> Deine eigene Zeitreise (Optional)</h2>
      <div class="form-group">
        <label>Stell dir vor, du lebst selbst im alten Ägypten:</label>
        <textarea class="form-control" placeholder="Wie würde dein Alltag aussehen? Als was würdest du arbeiten? Welche Herausforderungen würdest du meistern müssen?"></textarea>
      </div>
      
      <div class="form-group">
        <label>Deine Fragen an die Vergangenheit:</label>
        <textarea class="form-control" placeholder="Wenn du einen echten Ägypter aus dieser Zeit treffen könntest - welche Fragen würdest du stellen, die Essam vielleicht nicht beantworten konnte?"></textarea>
      </div>
    </div>

    <div class="section">
      <h2><i class="fas fa-save"></i> Zwischenspeichern & Fortsetzen</h2>
      <p>Speichere deine Arbeit zwischen oder lade eine vorherige Sitzung:</p>
      
      <div style="display: flex; gap: 15px; margin: 20px 0; flex-wrap: wrap;">
        <button id="saveProgressBtn" class="chat-btn">
          <i class="fas fa-save"></i>
          Fortschritt zwischenspeichern
        </button>
        
        <button id="loadProgressBtn" class="chat-btn" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">
          <i class="fas fa-upload"></i>
          Gespeicherten Fortschritt laden
        </button>
      </div>
      
      <div id="dropZone" class="hint" style="border: 2px dashed #DAA520; text-align: center; padding: 30px; cursor: pointer; transition: all 0.3s ease; display: none;">
        <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; color: #DAA520; margin-bottom: 10px;"></i>
        <p><strong>JSON-Datei hier hineinziehen</strong><br>oder klicken zum Auswählen</p>
      </div>
      
      <input type="file" id="fileInput" accept=".json" style="display: none;">
      
      <div class="hint">
        <strong>Zwischenspeichern:</strong> Erstellt eine JSON-Datei mit allen deinen Eingaben.<br>
        <strong>Fortsetzen:</strong> Lädt eine zuvor gespeicherte JSON-Datei und füllt alle Felder automatisch aus.
      </div>
    </div>

    <div class="section">
      <h2><i class="fas fa-download"></i> Arbeitsblatt exportieren</h2>
      <p>Exportiere deine Antworten und Erkenntnisse als PDF-Dokument für deine Unterlagen:</p>
      
      <button id="exportPdfBtn" class="chat-btn" style="margin-top: 20px;">
        <i class="fas fa-file-pdf"></i>
        Arbeitsblatt als PDF exportieren
      </button>
      
      <div class="hint" style="margin-top: 20px;">
        <strong>Hinweis:</strong> Das PDF enthält alle deine eingetragenen Fragen, Antworten und Reflexionen. Du kannst es für deine Dokumentation verwenden oder später nochmal durchlesen.
      </div>
    </div>
  </div>

  <!-- Modal for iOS save -->
  <div id="saveModal" class="save-modal">
    <div class="save-modal-content">
      <h3>Fortschritt speichern</h3>
      <p>Kopiere den folgenden Text und speichere ihn in einer Notiz-App oder sende ihn dir selbst zu:</p>
      <div id="saveModalText" class="save-modal-text"></div>
      <div class="save-modal-buttons">
        <button id="copyBtn" class="save-modal-btn copy">
          <i class="fas fa-copy"></i> Text kopieren
        </button>
        <button id="closeModalBtn" class="save-modal-btn close">
          <i class="fas fa-times"></i> Schließen
        </button>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    // Scroll progress indicator
    window.addEventListener('scroll', () => {
      const scrolled = (window.pageYOffset / (document.documentElement.scrollHeight - window.innerHeight)) * 100;
      document.getElementById('scrollProgress').style.width = scrolled + '%';
    });
    
    // Add smooth scrolling and entrance animations
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.style.opacity = '1';
          entry.target.style.transform = 'translateY(0)';
        }
      });
    });
    
    document.querySelectorAll('.section').forEach(section => {
      section.style.opacity = '0';
      section.style.transform = 'translateY(30px)';
      section.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
      observer.observe(section);
    });
    
    // Simple form enhancement
    const inputs = document.querySelectorAll('input, textarea');
    inputs.forEach(input => {
      input.addEventListener('focus', () => {
        input.style.transform = 'scale(1.02)';
      });
      
      input.addEventListener('blur', () => {
        input.style.transform = 'scale(1)';
      });
    });
    
    // Check if device is iOS/iPadOS
    function isIOS() {
      return /iPad|iPhone|iPod/.test(navigator.userAgent) || 
             (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
    }
    
    // Wait for DOM to be fully loaded
    document.addEventListener('DOMContentLoaded', function() {
      initializeSaveLoadFunctionality();
    });
    
    // Initialize save/load functionality
    function initializeSaveLoadFunctionality() {
      // Save functionality
      const saveBtn = document.getElementById('saveProgressBtn');
      if (saveBtn) {
        saveBtn.addEventListener('click', function() {
          console.log('Save button clicked!');
          
          const formData = {};
          
          // Collect all form data
          const questionInputs = document.querySelectorAll('.question-card input');
          formData.questions = Array.from(questionInputs).map(input => input.value);
          
          const ownQuestionInput = document.querySelector('input[placeholder*="Deine Frage hier eingeben..."]');
          formData.ownQuestion = ownQuestionInput ? ownQuestionInput.value : '';
          
          const insightsTextarea = document.querySelector('textarea[placeholder*="Notiere hier die faszinierendsten"]');
          formData.insights = insightsTextarea ? insightsTextarea.value : '';
          
          const surprisedTextarea = document.querySelector('textarea[placeholder*="Was hat dich am meisten überrascht"]');
          formData.surprised = surprisedTextarea ? surprisedTextarea.value : '';
          
          const criticalTextarea = document.querySelector('textarea[placeholder*="Wie glaubwürdig wirkten"]');
          formData.critical = criticalTextarea ? criticalTextarea.value : '';
          
          const timeTravelTextarea = document.querySelector('textarea[placeholder*="Wie würde dein Alltag aussehen"]');
          formData.timeTravel = timeTravelTextarea ? timeTravelTextarea.value : '';
          
          const furtherQuestionsTextarea = document.querySelector('textarea[placeholder*="welche Fragen würdest du stellen"]');
          formData.furtherQuestions = furtherQuestionsTextarea ? furtherQuestionsTextarea.value : '';
          
          // Add metadata
          formData.timestamp = new Date().toISOString();
          formData.version = "1.0";
          formData.title = "Zeitreise ins alte Ägypten - Zwischenspeicherung";
          
          console.log('Form data collected:', formData);
          
          try {
            const dataStr = JSON.stringify(formData, null, 2);
            
            // Check if iOS/iPadOS
            if (isIOS()) {
              // Show modal with copyable text for iOS
              const modal = document.getElementById('saveModal');
              const modalText = document.getElementById('saveModalText');
              modalText.textContent = dataStr;
              modal.style.display = 'flex';
              
              // Success feedback
              const originalText = this.innerHTML;
              this.innerHTML = '<i class="fas fa-check"></i> Daten bereitgestellt!';
              this.style.background = 'linear-gradient(135deg, #28a745 0%, #20c997 100%)';
              
              setTimeout(() => {
                this.innerHTML = originalText;
                this.style.background = 'linear-gradient(135deg, #DAA520 0%, #CD853F 100%)';
              }, 3000);
              
            } else {
              // Use blob download for non-iOS devices
              const dataBlob = new Blob([dataStr], {type: 'application/json'});
              const url = URL.createObjectURL(dataBlob);
              
              const link = document.createElement('a');
              link.href = url;
              link.download = `Zeitreise_Aegypten_Fortschritt_${new Date().toISOString().split('T')[0]}.json`;
              document.body.appendChild(link);
              link.click();
              document.body.removeChild(link);
              
              URL.revokeObjectURL(url);
              
              console.log('File download initiated');
              
              // Success feedback
              const originalText = this.innerHTML;
              this.innerHTML = '<i class="fas fa-check"></i> Fortschritt gespeichert!';
              this.style.background = 'linear-gradient(135deg, #28a745 0%, #20c997 100%)';
              
              setTimeout(() => {
                this.innerHTML = originalText;
                this.style.background = 'linear-gradient(135deg, #DAA520 0%, #CD853F 100%)';
              }, 3000);
            }
            
          } catch (error) {
            console.error('Error during save:', error);
            alert('Fehler beim Speichern. Bitte versuchen Sie es erneut.');
          }
        });
      } else {
        console.error('Save button not found!');
      }
      
      // Modal copy button
      const copyBtn = document.getElementById('copyBtn');
      if (copyBtn) {
        copyBtn.addEventListener('click', function() {
          const modalText = document.getElementById('saveModalText');
          
          // Try different copy methods
          if (navigator.clipboard && navigator.clipboard.writeText) {
            // Modern way
            navigator.clipboard.writeText(modalText.textContent)
              .then(() => {
                const originalText = this.innerHTML;
                this.innerHTML = '<i class="fas fa-check"></i> Kopiert!';
                setTimeout(() => {
                  this.innerHTML = originalText;
                }, 2000);
              })
              .catch(() => {
                // Fallback for iOS
                selectAndCopy(modalText);
              });
          } else {
            // Fallback method
            selectAndCopy(modalText);
          }
        });
      }
      
      // Helper function for iOS copy
      function selectAndCopy(element) {
        const range = document.createRange();
        range.selectNodeContents(element);
        const selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);
        
        try {
          document.execCommand('copy');
          const copyBtn = document.getElementById('copyBtn');
          const originalText = copyBtn.innerHTML;
          copyBtn.innerHTML = '<i class="fas fa-check"></i> Kopiert!';
          setTimeout(() => {
            copyBtn.innerHTML = originalText;
          }, 2000);
        } catch (err) {
          alert('Bitte den Text manuell auswählen und kopieren.');
        }
        
        selection.removeAllRanges();
      }
      
      // Modal close button
      const closeModalBtn = document.getElementById('closeModalBtn');
      if (closeModalBtn) {
        closeModalBtn.addEventListener('click', function() {
          document.getElementById('saveModal').style.display = 'none';
        });
      }
    }
    
    // Load functionality
    setTimeout(() => {
      const loadBtn = document.getElementById('loadProgressBtn');
      if (loadBtn) {
        loadBtn.addEventListener('click', function() {
          const dropZone = document.getElementById('dropZone');
          if (dropZone.style.display === 'none') {
            dropZone.style.display = 'block';
            dropZone.style.borderColor = '#28a745';
            
            // Different text for iOS
            if (isIOS()) {
              dropZone.innerHTML = `
                <i class="fas fa-paste" style="font-size: 2rem; color: #28a745; margin-bottom: 10px;"></i>
                <p><strong>JSON-Text einfügen</strong></p>
                <textarea id="pasteArea" style="width: 100%; height: 150px; margin: 15px 0; padding: 10px; border: 1px solid #DAA520; border-radius: 8px;" placeholder="Füge hier den kopierten JSON-Text ein..."></textarea>
                <div style="display: flex; gap: 15px; justify-content: center;">
                  <button onclick="loadFromPaste()" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">Laden</button>
                  <button onclick="document.getElementById('dropZone').style.display='none'" style="background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">Abbrechen</button>
                </div>
              `;
            } else {
              dropZone.innerHTML = `
                <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; color: #28a745; margin-bottom: 10px;"></i>
                <p><strong>JSON-Datei hier hineinziehen</strong><br>oder klicken zum Auswählen</p>
                <p style="margin-top: 15px;"><button onclick="document.getElementById('dropZone').style.display='none'" style="background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer;">Abbrechen</button></p>
              `;
            }
          } else {
            dropZone.style.display = 'none';
          }
        });
        
        // File input handling for non-iOS
        if (!isIOS()) {
          const dropZone = document.getElementById('dropZone');
          const fileInput = document.getElementById('fileInput');
          
          if (dropZone && fileInput) {
            dropZone.addEventListener('click', function(e) {
              if (e.target.tagName !== 'BUTTON' && !isIOS()) {
                fileInput.click();
              }
            });
            
            fileInput.addEventListener('change', function(e) {
              const file = e.target.files[0];
              if (file) {
                loadJsonFile(file);
              }
            });
            
            // Drag and drop functionality
            dropZone.addEventListener('dragover', function(e) {
              e.preventDefault();
              dropZone.style.borderColor = '#007bff';
              dropZone.style.backgroundColor = 'rgba(0, 123, 255, 0.1)';
            });
            
            dropZone.addEventListener('dragleave', function(e) {
              e.preventDefault();
              dropZone.style.borderColor = '#28a745';
              dropZone.style.backgroundColor = 'transparent';
            });
            
            dropZone.addEventListener('drop', function(e) {
              e.preventDefault();
              dropZone.style.borderColor = '#28a745';
              dropZone.style.backgroundColor = 'transparent';
              
              const files = e.dataTransfer.files;
              if (files.length > 0 && files[0].name.endsWith('.json')) {
                loadJsonFile(files[0]);
              } else {
                alert('Bitte nur JSON-Dateien verwenden!');
              }
            });
          }
        }
      }
    }, 100);
    
    // Function to load from pasted text (iOS)
    window.loadFromPaste = function() {
      const pasteArea = document.getElementById('pasteArea');
      if (pasteArea && pasteArea.value) {
        try {
          const data = JSON.parse(pasteArea.value);
          loadFormData(data);
          document.getElementById('dropZone').style.display = 'none';
        } catch (error) {
          alert('Fehler beim Laden. Bitte überprüfen Sie, ob der Text ein gültiges JSON-Format hat.');
          console.error('JSON Parse Error:', error);
        }
      } else {
        alert('Bitte fügen Sie zuerst den JSON-Text ein.');
      }
    };
    
    // Function to load JSON file
    function loadJsonFile(file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          loadFormData(data);
        } catch (error) {
          alert('Fehler beim Laden der Datei. Bitte überprüfen Sie, ob es eine gültige JSON-Datei ist.');
          console.error('JSON Parse Error:', error);
        }
      };
      reader.readAsText(file);
    }
    
    // Function to load form data
    function loadFormData(data) {
      // Validate data structure
      if (!data.version || !data.questions) {
        alert('Diese Datei scheint nicht vom Zeitreise-Arbeitsblatt zu stammen.');
        return;
      }
      
      // Fill form fields
      const questionInputs = document.querySelectorAll('.question-card input');
      if (data.questions) {
        questionInputs.forEach((input, index) => {
          if (data.questions[index]) {
            input.value = data.questions[index];
          }
        });
      }
      
      const ownQuestionInput = document.querySelector('input[placeholder*="Deine Frage hier eingeben..."]');
      if (data.ownQuestion && ownQuestionInput) {
        ownQuestionInput.value = data.ownQuestion;
      }
      
      const insightsTextarea = document.querySelector('textarea[placeholder*="Notiere hier die faszinierendsten"]');
      if (data.insights && insightsTextarea) {
        insightsTextarea.value = data.insights;
      }
      
      const surprisedTextarea = document.querySelector('textarea[placeholder*="Was hat dich am meisten überrascht"]');
      if (data.surprised && surprisedTextarea) {
        surprisedTextarea.value = data.surprised;
      }
      
      const criticalTextarea = document.querySelector('textarea[placeholder*="Wie glaubwürdig wirkten"]');
      if (data.critical && criticalTextarea) {
        criticalTextarea.value = data.critical;
      }
      
      const timeTravelTextarea = document.querySelector('textarea[placeholder*="Wie würde dein Alltag aussehen"]');
      if (data.timeTravel && timeTravelTextarea) {
        timeTravelTextarea.value = data.timeTravel;
      }
      
      const furtherQuestionsTextarea = document.querySelector('textarea[placeholder*="welche Fragen würdest du stellen"]');
      if (data.furtherQuestions && furtherQuestionsTextarea) {
        furtherQuestionsTextarea.value = data.furtherQuestions;
      }
      
      // Hide drop zone and show success
      document.getElementById('dropZone').style.display = 'none';
      
      const btn = document.getElementById('loadProgressBtn');
      const originalText = btn.innerHTML;
      btn.innerHTML = '<i class="fas fa-check"></i> Fortschritt geladen!';
      
      setTimeout(() => {
        btn.innerHTML = originalText;
      }, 3000);
      
      // Scroll to top to show loaded content
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    
    // PDF Export functionality
    document.getElementById('exportPdfBtn').addEventListener('click', function() {
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF();
      
      // PDF styling
      const pageWidth = pdf.internal.pageSize.getWidth();
      const margin = 20;
      const maxWidth = pageWidth - 2 * margin;
      let yPosition = 20;
      
      // Helper function to add text with word wrapping
      function addText(text, x, y, fontSize = 12, style = 'normal') {
        pdf.setFontSize(fontSize);
        pdf.setFont('helvetica', style);
        const lines = pdf.splitTextToSize(text, maxWidth);
        pdf.text(lines, x, y);
        return y + (lines.length * fontSize * 0.4) + 5;
      }
      
      // Helper function to check for new page
      function checkNewPage(requiredSpace = 30) {
        if (yPosition > 250) {
          pdf.addPage();
          yPosition = 20;
        }
      }
      
      // Title
      pdf.setFillColor(218, 165, 32);
      pdf.rect(0, 0, pageWidth, 40, 'F');
      pdf.setTextColor(255, 255, 255);
      yPosition = addText('Zeitreise ins alte Ägypten - Arbeitsblatt', margin, 25, 18, 'bold');
      yPosition = addText('Interview mit Essam ibn Kheti', margin, yPosition - 5, 14, 'normal');
      
      // Reset text color
      pdf.setTextColor(0, 0, 0);
      yPosition += 15;
      
      // Get all form inputs
      const questionInputs = document.querySelectorAll('.question-card input');
      const ownQuestion = document.querySelector('input[placeholder*="Deine Frage hier eingeben..."]');
      const insights = document.querySelector('textarea[placeholder*="Notiere hier die faszinierendsten"]');
      const surprised = document.querySelector('textarea[placeholder*="Was hat dich am meisten überrascht"]');
      const critical = document.querySelector('textarea[placeholder*="Wie glaubwürdig wirkten"]');
      const timeTravel = document.querySelector('textarea[placeholder*="Wie würde dein Alltag aussehen"]');
      const questions = document.querySelector('textarea[placeholder*="welche Fragen würdest du stellen"]');
      
      // Questions section
      checkNewPage();
      yPosition = addText('Vorbereitete Fragen:', margin, yPosition, 16, 'bold');
      yPosition += 5;
      
      const questionLabels = ['Tagesablauf', 'Familienleben', 'Werkzeuge', 'Essen'];
      questionInputs.forEach((input, index) => {
        if (input.value.trim()) {
          checkNewPage();
          yPosition = addText(`${questionLabels[index]}: ${input.value}`, margin, yPosition, 11, 'normal');
          yPosition += 3;
        }
      });
      
      if (ownQuestion && ownQuestion.value.trim()) {
        checkNewPage();
        yPosition = addText(`Eigene Frage: ${ownQuestion.value}`, margin, yPosition, 11, 'normal');
        yPosition += 8;
      }
      
      // Interview insights
      if (insights && insights.value.trim()) {
        checkNewPage(50);
        yPosition = addText('Erkenntnisse aus dem Interview:', margin, yPosition, 16, 'bold');
        yPosition += 5;
        yPosition = addText(insights.value, margin, yPosition, 11, 'normal');
        yPosition += 8;
      }
      
      // Reflection section
      checkNewPage(50);
      yPosition = addText('Reflexion & Analyse:', margin, yPosition, 16, 'bold');
      yPosition += 5;
      
      if (surprised && surprised.value.trim()) {
        checkNewPage();
        yPosition = addText('Was hat überrascht:', margin, yPosition, 14, 'bold');
        yPosition += 3;
        yPosition = addText(surprised.value, margin, yPosition, 11, 'normal');
        yPosition += 8;
      }
      
      if (critical && critical.value.trim()) {
        checkNewPage();
        yPosition = addText('Kritische Betrachtung:', margin, yPosition, 14, 'bold');
        yPosition += 3;
        yPosition = addText(critical.value, margin, yPosition, 11, 'normal');
        yPosition += 8;
      }
      
      // Optional sections
      if (timeTravel && timeTravel.value.trim()) {
        checkNewPage();
        yPosition = addText('Eigene Zeitreise:', margin, yPosition, 14, 'bold');
        yPosition += 3;
        yPosition = addText(timeTravel.value, margin, yPosition, 11, 'normal');
        yPosition += 8;
      }
      
      if (questions && questions.value.trim()) {
        checkNewPage();
        yPosition = addText('Weitere Fragen:', margin, yPosition, 14, 'bold');
        yPosition += 3;
        yPosition = addText(questions.value, margin, yPosition, 11, 'normal');
      }
      
      // Footer
      const pageCount = pdf.internal.getNumberOfPages();
      for (let i = 1; i <= pageCount; i++) {
        pdf.setPage(i);
        pdf.setFontSize(8);
        pdf.setTextColor(100, 100, 100);
        pdf.text(`Seite ${i} von ${pageCount} - Erstellt am ${new Date().toLocaleDateString('de-DE')}`, 
                 pageWidth - margin, pdf.internal.pageSize.getHeight() - 10, { align: 'right' });
      }
      
      // Save the PDF
      const currentDate = new Date().toISOString().split('T')[0];
      pdf.save(`Zeitreise_Altes_Aegypten_${currentDate}.pdf`);
      
      // Success feedback
      const btn = document.getElementById('exportPdfBtn');
      const originalText = btn.innerHTML;
      btn.innerHTML = '<i class="fas fa-check"></i> PDF erfolgreich erstellt!';
      btn.style.background = 'linear-gradient(135deg, #28a745 0%, #20c997 100%)';
      
      setTimeout(() => {
        btn.innerHTML = originalText;
        btn.style.background = 'linear-gradient(135deg, #DAA520 0%, #CD853F 100%)';
      }, 3000);
    });
  </script>
</body>
</html>
